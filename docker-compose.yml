version: '3.8'

services:
  financeai:
    build: .
    container_name: financeai
    ports:
      - "${BACKEND_PORT:-8001}:${BACKEND_PORT:-8001}"
      - "${FRONTEND_PORT:-3000}:${FRONTEND_PORT:-3000}"
    environment:
      - LLM_MODEL=${LLM_MODEL:-gpt-4o}
      - LLM_API_KEY=${LLM_API_KEY}
      - LLM_HOST=${LLM_HOST:-https://api.openai.com/v1}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL}
      - EMBEDDING_API_KEY=${EMBEDDING_API_KEY}
      - ALPHA_VANTAGE_API_KEY=${ALPHA_VANTAGE_API_KEY}
      - OPENDART_API_KEY=${OPENDART_API_KEY}
      - SEARCH_PROVIDER=${SEARCH_PROVIDER}
      - SEARCH_API_KEY=${SEARCH_API_KEY}
      - BACKEND_PORT=${BACKEND_PORT:-8001}
      - FRONTEND_PORT=${FRONTEND_PORT:-3000}
      - NEXT_PUBLIC_API_BASE=http://localhost:${BACKEND_PORT:-8001}
    volumes:
      - ./config:/app/config:ro
      - ./data:/app/data
    restart: unless-stopped

  # Development service with hot reload
  financeai-dev:
    build:
      context: .
      target: python-base
    container_name: financeai-dev
    ports:
      - "${BACKEND_PORT:-8001}:${BACKEND_PORT:-8001}"
    environment:
      - LLM_MODEL=${LLM_MODEL:-gpt-4o}
      - LLM_API_KEY=${LLM_API_KEY}
      - LLM_HOST=${LLM_HOST:-https://api.openai.com/v1}
      - BACKEND_PORT=${BACKEND_PORT:-8001}
    volumes:
      - ./src:/app/src
      - ./config:/app/config
      - ./data:/app/data
    command: python -m uvicorn src.api.main:app --host 0.0.0.0 --port ${BACKEND_PORT:-8001} --reload
    profiles:
      - dev
